{% extends 'tasks/base.html' %}
{% block content %}
<div class="container">
    <!-- <h1 class="page-title">{{ task.title|upper }}</h1> -->

    <div class="task-card">
        <h1 class="task-title">{{ task.title }}</h1>

        <p class="due-date">Author: {{ task.creator }}</p>

        <div class="task-meta">
            <span class="status">Status: {{ task.get_status_display }}</span>
            <span class="priority">Priority: {{ task.get_priority_display }}</span>
        </div>

        <div class="task-description">
            {{ task.description }}
        </div>

        <p class="due-date">Due to: {{ task.due_date }}</p>

        <div class="timestamps">
            <span>Created: {{ task.created_at }}</span>
            <span>Updated: {{ task.updated_at }}</span>
        </div>

        <div class="task-actions">
            {% if request.user == task.author %}
                <a href="{% url 'tasks:task-update' task.pk %}">Edit</a>
                <a href="{% url 'tasks:task-delete' task.pk %}">Delete</a>
            {% elif request.user.is_staff %}
                <a href="{% url 'tasks:task-delete' task.pk %}">Delete</a>
            {% endif %}
            <a href="{% url 'tasks:task-list' %}">Back</a>
        </div>
    </div>

    <h3 class="section-title">Add a Comment</h3>
    <form method="post" class="comment-form">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn-dark">Post</button>
    </form>

    <h2 class="section-title">Comments</h2>
    <div class="comments">
        {% for comment in task.comments.all %}
        <div class="comment-card fade-in">
            <div class="comment-header">
                <strong>{{ comment.author }}</strong>
                <em>{{ comment.created_at }}</em>
            </div>

            <p>{{ comment.content|safe }}</p>

            <div class="comment-actions">
                <span>Likes: {{ comment.likes.count }}</span>

                {% if request.user.is_authenticated %}
                <form action="{% url 'comments:comment-like' comment.pk %}" method="post" class="like-form">
                    {% csrf_token %}
                    <button type="submit" class="like-btn">
                        {% if comment.liked_by_current_user %}
                            ‚ù§Ô∏è
                        {% else %}
                            ü§ç
                        {% endif %}
                    </button>
                    <!-- <span class="like-count">{{ comment.likes.count }}</span> -->
                </form>
                {% endif %}

                {% if request.user.is_staff %}
                <form action="{% url 'tasks:comment-delete' comment.pk %}" method="post" class="delete-form" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-small">Delete</button>
                </form>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <p>No comments yet.</p>
        {% endfor %}
    </div>

</div>

<style>
/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 40px 20px;
    color: #e0e0e0;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
.page-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 25px;
}

.task-card {
    background-color: #1e1e1e;
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 40px;
    color: #e0e0e0;
}

.task-title {
    text-transform: uppercase;
    font-size: 1.8rem;
    font-weight: bold;
    margin-bottom: 15px;
    color: #ffffff;
}

.task-meta {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
    font-size: 1rem;
    color: #c0c0c0;
}

.task-description {
    background-color: #2a2a2a;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 1rem;
    color: #dcdcdc;
}

.due-date {
    font-weight: bold;
    margin-bottom: 15px;
    color: #f0f0f0;
}

.timestamps {
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
    color: rgba(224, 224, 224, 0.6);
    margin-bottom: 20px;
}

.task-actions a {
    margin-right: 15px;
    color: #e0e0e0;
    text-decoration: none;
    padding: 6px 12px;
    border: 1px solid #444;
    border-radius: 6px;
    transition: background-color 0.2s ease;
}

.task-actions a:hover {
    background-color: #333;
}
/* –ö–Ω–æ–ø–∫–∏ */
.btn-dark {
    display: inline-block;
    padding: 8px 16px;
    background-color: #1f1f1f;
    color: #e0e0e0;
    border-radius: 6px;
    text-decoration: none;
    transition: background-color 0.2s;
}
.btn-dark:hover {
    background-color: #333;
}
.btn-small {
    padding: 4px 10px;
    font-size: 0.85rem;
    background-color: #2a2a2a;
    color: #e0e0e0;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}
.btn-small:hover {
    background-color: #444;
}

/* –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü—ñ–π */
.section-title {
    margin: 30px 0 15px;
    font-size: 1.4rem;
    font-weight: 600;
}

/* –§–æ—Ä–º–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ */
.comment-form {
    background-color: #1e1e1e;
    padding: 20px;              /* —Ç—É—Ç –∑–∞–¥–∞—é—Ç—å—Å—è –≤—ñ–¥—Å—Ç—É–ø–∏ –∑–ª—ñ–≤–∞/—Å–ø—Ä–∞–≤–∞ */
    border-radius: 10px;
    margin-bottom: 40px;
}

.comment-form input, 
.comment-form textarea, 
.comment-form select {
    width: 100%;                /* –∑–∞–π–º–∞—î –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É —à–∏—Ä–∏–Ω—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–∞–¥–¥—ñ–Ω–≥—ñ–≤ */
    box-sizing: border-box;     /* –≤—Ä–∞—Ö–æ–≤—É—î padding –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ .comment-form */
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #333;
    background-color: #121212;
    color: #e0e0e0;
    margin-bottom: 15px;
    font-size: 1rem;
    resize: vertical;
}

.comment-form button {
    display: inline-block;
    padding: 8px 16px;
    background-color: #1f1f1f;
    color: #e0e0e0;
    border-radius: 6px;
    border: none;
    cursor: pointer;
}
.comment-form button:hover {
    background-color: #333;
}

/* –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ */
.comments {
    display: flex;
    flex-direction: column;
    gap: 20px;
}
.comment-card {
    background-color: #1e1e1e;
    padding: 15px;
    border-radius: 8px;
    position: relative;
}
.comment-header {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
    margin-bottom: 8px;
}
.delete-form {
    margin-top: 8px; /* —Ç–µ–ø–µ—Ä –∫–Ω–æ–ø–∫–∞ –π–¥–µ –Ω–∏–∂—á–µ */
}


/* –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏ */
.fade-in {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
}
.fade-in.visible {
    opacity: 1;
    transform: translateY(0);
}

.comment-actions {
    display: flex;
    justify-content: flex-end; /* –≤—Å–µ –≤–∏—Ä—ñ–≤–Ω—é—î–º–æ –≤–ø—Ä–∞–≤–æ */
    align-items: center;
    gap: 8px;
    margin-top: 10px;
}

.like-form {
    display: flex;
    align-items: center;
    gap: 5px;
}

.like-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.2rem; /* —Ä–æ–∑–º—ñ—Ä —Å–µ—Ä—Ü—è */
    line-height: 1;
    padding: 0;
    transition: transform 0.1s ease;
}

.like-btn:hover {
    transform: scale(1.2); /* –ª–µ–≥–∫–µ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–Ω—ñ */
}

.like-count {
    font-size: 0.9rem;
    color: #e0e0e0;
}

</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if(entry.isIntersecting){
                entry.target.classList.add('visible');
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
});
</script>
{% endblock %}
